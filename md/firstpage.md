## Gemã®ä½œã‚Šæ–¹
ğŸ’æ™®é€šã® Gem ã®ç°¡å˜ãªä½œã‚Šæ–¹ğŸ’
<b><!-- --></b>  
<b><!-- --></b>  
Created by [Iori ONDA](https://github.com/iorionda)  
http://twitter.com/120reset

---
## about me

>>>

![profile](./images/profile.png)

---

## ç›®çš„

>>>

Gemã®ä½œã‚Šæ–¹ã‚’ãŠã¼ãˆã¦  
å…±é€šã™ã‚‹å‡¦ç†ã‚’æ°—è»½ã«Gemã«ã—ã¦  
æœ¬è³ªçš„ãªãƒ­ã‚¸ãƒƒã‚¯ã«æ³¨åŠ›ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹!!1âœŠ

---

## å†…å®¹

>>>

- Gemã¨ã¯ä½•ã‹
- Gemã‚’ä½œã‚‹åŸºæœ¬çš„ãªæµã‚Œ
- ã¾ã¨ã‚

---

## ãã‚‚ãã‚‚ Gem ã£ã¦ãªã‚“ãªã®

>>>

- Gemã¯Rubyã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ã®ç‚ºã®ã‚³ãƒãƒ³ãƒ‰ã€‚  
- Rubyã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ¤œç´¢ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãªã©ã‚’æœ€å°é™ã®è‹¦åŠ´ã§å‡ºæ¥ã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã€‚  
- Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.9ä»¥é™ã¯æ¨™æº–æ·»ä»˜ã¨ãªã£ã¦ã„ã‚‹ã€‚

>>>

æ˜”ã¯ *echoe gem* ã‚„ *Jeweler* ãªã©ãŒã‚ã£ãŸã‘ã‚Œã©ã€ä»Šã¯ *Bundler* ã§å¤§å‹¢ãŒæ±ºã¾ã£ã¦ã„ã‚‹ã€‚
ãªã®ã§ã€ä»Šå›ã‚‚ *Bundler* ã‚’ä½¿ã£ã¦Gemã‚’ä½œã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã™ã‚‹ğŸ’ğŸ’ğŸ’

>>>

ä»Šã¾ã§ä¾¿åˆ©ã«ä½¿ã£ã¦ã¯ã„ã‚‹ã‘ã‚Œã©  
ã‚ã¾ã‚Šgemã‚’ä½œã£ã¦å…¬é–‹ã—ã¦ã„ã‚‹äººã¯ã„ãªã„ã¯ãšğŸ˜Œ

>>>

ä»Šæ—¥ã‹ã‚‰è‡ªåˆ†ã§ä½œã£ãŸã‚‚ã®ã‚‚gemã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã‚ˆã†ğŸ˜„ğŸ˜„ğŸ˜„  
<b><!-- --></b>  
æœãŸã—ã¦ç°¡å˜ã«ã§ãã‚‹ã®ã‹!?ğŸ‘ğŸ‘‰

---

## ä½œæ¥­ç’°å¢ƒ

>>>

- MacBook Pro Retina15 OSX 10.9.5
- Ruby
```shellscript
% ruby --version
ruby 2.2.2p95 (2015-04-13 revision 50295) [x86_64-darwin13]
```

- Gem  
```
% gem --version
2.4.8
```

---

## åŸºæœ¬çš„ãªæµã‚Œ

---

## ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿

>>>

`bundle gem` ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã²ãªå½¢ã‚’ã¤ãã‚‹ã€‚

```ruby
% bundle gem gem_name
```

>>>

å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã‚‹

```
% bundle gem retriable
Creating gem 'retriable'...
/Users/ONDA/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/bundler-1.10.5/lib/bundler/cli/gem.rb:26: warning: Insecure world writable dir /Users/ONDA/bin/FDK/Tools/osx in PATH, mode 040777
Do you want to include a code of conduct in gems you generate?
<u are prepared to do that. For suggestions about how to enforce codes of conduct, see bit.ly/coc-enforcement. y/(n): y
Code of conduct enabled in config
Do you want to license your code permissively under the MIT license?
<ong as they admit you created it. You can read more about the MIT license at choosealicense.com/licenses/mit. y/(n): y
MIT License enabled in config
Do you want to generate tests with your gem?
Type 'rspec' or 'minitest' to generate those test files now and in the future. rspec/minitest/(none): minitest
      create  retriable/Gemfile
      create  retriable/.gitignore
      create  retriable/lib/retriable.rb
      create  retriable/lib/retriable/version.rb
      create  retriable/retriable.gemspec
      create  retriable/Rakefile
      create  retriable/README.md
      create  retriable/bin/console
      create  retriable/bin/setup
      create  retriable/CODE_OF_CONDUCT.md
      create  retriable/LICENSE.txt
      create  retriable/.travis.yml
      create  retriable/test/test_helper.rb
      create  retriable/test/retriable_test.rb
Initializing git repo in /Users/ONDA/Dropbox/github/retriable
```

>>>

é€”ä¸­ã§3å›ãã‚‰ã„è³ªå•ãŒã‚ã‚‹ã®ã§ y/(n) ã§å›ç­”ã™ã‚‹ã€‚  

>>>

è¨­å®šã—ãŸé …ç›®ã¯  `~/.bundle/config` ã«ä¿å­˜ã•ã‚Œã‚‹ã€‚

```
% cat ~/.bundle/config
---
BUNDLE_GEM__COC: true
BUNDLE_GEM__MIT: true
BUNDLE_GEM__TEST: minitest
```

>>>

## gemåã«ã¤ã„ã¦

>>>

gemã®åå‰ã® - ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«å±•é–‹ã•ã‚Œã‚‹ã€‚  
ä¾‹ãˆã° foo-bar ã¨ã„ã†åå‰ã§gemã‚’ä½œæˆã™ã‚‹ã¨  
<b><!-- --></b>  
`lib/foo-bar.rb` ã§ã¯ãªã  
<b><!-- --></b>  
`lib/foo/bar.rb` ã¨ãªã‚‹ã€‚

>>>

## é–‘è©±ä¼‘é¡Œ

>>>

ã“ã‚Œã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã²ãªå½¢ã¯ã§ããŸã®ã§  
è‚å¿ƒã®ä¸­èº«ã‚’ä½œã£ã¦ã„ãã€‚

---

## gemspec

>>>

gem_name.gem_specã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¯ãš

>>>

![gemspec](./images/gemspec.png)

>>>

gemspecãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯gemã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚

>>>

ç”Ÿæˆã•ã‚ŒãŸç›´å¾Œã¯ã“ã‚“ãªæ„Ÿã˜

```ruby
# coding: utf-8
lib = File.expand_path('../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)
require 'retriable/version'

Gem::Specification.new do |spec|
  spec.name          = "retriable"
  spec.version       = Retriable::VERSION
  spec.authors       = ["Iori ONDA"]
  spec.email         = ["iori.onda@gmail.com"]

  spec.summary       = %q{TODO: Write a short summary, because Rubygems requires one.}
  spec.description   = %q{TODO: Write a longer description or delete this line.}
  spec.homepage      = "TODO: Put your gem's website or public repo URL here."
  spec.license       = "MIT"

  # Prevent pushing this gem to RubyGems.org by setting 'allowed_push_host', or
  # delete this section to allow pushing this gem to any host.
  if spec.respond_to?(:metadata)
    spec.metadata['allowed_push_host'] = "TODO: Set to 'http://mygemserver.com'"
  else
    raise "RubyGems 2.0 or newer is required to protect against public gem pushes."
  end

  spec.files         = `git ls-files -z`.split("\x0").reject { |f| f.match(%r{^(test|spec|features)/}) }
  spec.bindir        = "exe"
  spec.executables   = spec.files.grep(%r{^exe/}) { |f| File.basename(f) }
  spec.require_paths = ["lib"]

  spec.add_development_dependency "bundler", "~> 1.10"
  spec.add_development_dependency "rake", "~> 10.0"
  spec.add_development_dependency "minitest"
end
```

>>>

ã¾ãšã¯ TODO ã‚’åŸ‹ã‚ã¦ã„ã“ã†

>>>

## ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤§äº‹ãªã¨ã“ã‚

>>>

- .add_dependency
- .add_development_dependency

>>>

## .add_dependency  
<b><!-- --></b>  
ä¾å­˜ã™ã‚‹gemã‚’æ›¸ã

>>>

## .add_development_dependency  
<b><!-- --></b>  
é–‹ç™ºæ™‚ã«ä¾å­˜ã™ã‚‹gemã‚’æ›¸ã

>>>

## ä»–ã®é …ç›®ã®æ„å‘³ã¯???

>>>

- name (gemã®packageå)
- version (gemã®version)
- authors (é–‹ç™ºè€…å)
- email (é€£çµ¡å…ˆ)
- description (è©³ç´°èª¬æ˜)
- summary (1è¡Œã®ç°¡æ˜“èª¬æ˜)
- homepage (é–¢é€£URL)
- license (gemã®å±ã™ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹)
- files (å…¬é–‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)
- executables (å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)
- test_files (ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)
- require_paths (å®Ÿéš›ã®gemã®å‡¦ç†ã‚’è¡Œã†ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹æŒ‡å®š)

>>>

## ãã‚Œä»¥å¤–ã®è¨­å®šå€¤ã¯?

>>>

defaultå€¤ã‚’æ›¸ãå‡ºã—ã¦ã¿ãŸ

```
[1] 2.2.2-p95(main)> Gem::Specification.new do |s|
[1] 2.2.2-p95(main)*   Gem::Specification.instance_methods.grep(/\w+=$/).sort.each do |i|
[1] 2.2.2-p95(main)*   default = s.send(i[0..-2]) rescue nil
[1] 2.2.2-p95(main)*     next if [nil, [], {}].include?(default)
[1] 2.2.2-p95(main)*     print i, " "
[1] 2.2.2-p95(main)*     p default
[1] 2.2.2-p95(main)*   end
[1] 2.2.2-p95(main)* end
activated= false
base_dir= "/Users/ONDA/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0"
bindir= "bin"
date= 2015-07-22 00:00:00 UTC
extension_dir= "/Users/ONDA/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/extensions/x86_64-darwin-13/2.2.0-static/-"
full_gem_path= "/Users/ONDA/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/-"
has_rdoc= true
installed_by_version= #<Gem::Version "0">
original_platform= "ruby"
platform= "ruby"
require_path= "lib"
require_paths= ["lib"]
required_ruby_version= #<Gem::Requirement:0x007febd14dcaa0 @requirements=[[">=", #<Gem::Version "0">]]>
required_rubygems_version= #<Gem::Requirement:0x007febd14dc9d8 @requirements=[[">=", #<Gem::Version "0">]]>
rubygems_version= "2.4.5"
specification_version= 4
```

>>>

ã§ã‚‚æ„è­˜ã™ã‚‹ã“ã¨ã¯ãªã„ã§ã™ğŸ˜‡

>>>

## æ³¨æ„ç‚¹

>>>

ä¸–ç•Œä¸­ã®é–‹ç™ºè€…ãŒè¦‹ã‚‹ã®ã§æ¥µåŠ›è‹±èªã§æ›¸ã„ãŸæ–¹ãŒã„ã„  
ğŸ‘±ğŸ‘²ğŸ‘³

---

## ä¸­èº«ã®ä½œã‚Šæ–¹

>>>

ã¾ãšã¯ *lib/retriable.rb* ã‚’ã¿ã¦ã¿ã‚ˆã†ã€‚

>>>

```ruby
require "retriable/version"

module Retriable
  # Your code goes here...
end
```

>>>

class ã˜ã‚ƒãªãã¦ module ã«ãªã£ã¦ã„ã‚‹ã€‚

>>>

ã“ã“ã¯ module ã®ã¾ã¾ã§  
å®Ÿéš›ã®å‡¦ç†ã¯åˆ¥ã® class ã«ä»»ã›ã‚‹ã€‚

>>>

RetryLimitError ã¨ã„ã† class ã‚’ä½œã‚‹ãªã‚‰  
*lib/retriable/retry_error.rb* ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚

>>>

```
% touch lib/retriable/retry_error.rb
```

>>>

ã“ã‚“ãªæ„Ÿã˜ã«æ›¸ã„ã¦ãŠã

```ruby
module Retriable
  class RetryError
  # Your code goes here...
end
```

>>>

ã‚¯ãƒ©ã‚¹æ§‹é€ ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä¸€è‡´ã•ã›ãªã„ã¨ãƒ€ãƒ¡ ğŸ˜–

>>>

ä½œã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ *lib/retriable.rb* ã®ä¸­ã§ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚

>>>

```ruby
require "retriable/version"
require 'retriable/retry_error'

module Retriable
  # Your code goes here...
end
```

---

## ãƒ“ãƒ«ãƒ‰ã¨ãƒªãƒªãƒ¼ã‚¹

>>>

ãƒ“ãƒ«ãƒ‰ã‚„ãƒªãƒªãƒ¼ã‚¹ã¯ rake ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹

>>>

```
% rake -T
rake build          # Build retriable-0.1.0.gem into the pkg directory
rake install        # Build and install retriable-0.1.0.gem into system gems
rake install:local  # Build and install retriable-0.1.0.gem into system gems without network access
rake release        # Create tag v0.1.0 and build and push retriable-0.1.0.gem to Rubygems
rake test           # Run tests
```

>>>

## ãƒ“ãƒ«ãƒ‰

>>>

```
% rake build
retriable 0.1.0 built to pkg/retriable-0.1.0.gem.
```

>>>

gem ãƒ•ã‚¡ã‚¤ãƒ«ãŒå®Œæˆã—ãŸã âœŠ

>>>

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

>>>

```
% rake install
retriable 0.1.0 built to pkg/retriable-0.1.0.gem.
retriable (0.1.0) installed.
```

>>>

### RubyGemsã®APIã‚­ãƒ¼ã®å–å¾—

>>>

ã¾ãšã¯ RubyGems ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹

>>>

```
% curl -u [user-name] https://rubygems.org/api/v1/api_key.yaml > ~/.gem/credentials
```

>>>

## ãƒªãƒªãƒ¼ã‚¹

>>>

ãƒªãƒªãƒ¼ã‚¹ã‚’ã™ã‚‹ã«ã¯ã€æ‰‹å‹•ã§ lib/gem_name/version.rb ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ãªã‘ã‚Œã°ã„ã‘ãªã„ğŸ˜•

>>>

```
% rake release
```

---

## ã¾ã¨ã‚

>>>

ã“ã‚Œã§ã‚‚ã†ã„ã¤ã§ã‚‚gemã‚’ä½œã‚Œã‚‹ğŸ™ğŸ™ğŸ™

---

## å‚è€ƒè³‡æ–™

>>>

- http://masarakki.github.io/blog/2014/02/15/how-to-create-gem/
- http://morizyun.github.io/blog/ruby-gem-easy-publish-library-rails/
- http://d.hatena.ne.jp/zariganitosh/20141016/minimum_making_of_gem
